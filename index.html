<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ISS Tracker - Real-time International Space Station Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #0a0e27;
        color: #e0e6ed;
        overflow: hidden;
      }

      .container {
        display: flex;
        height: 100vh;
        position: relative;
      }

      .globe-container {
        flex: 0 0 70%;
        position: relative;
        height: 100vh;
      }

      .sidebar {
        flex: 0 0 30%;
        background-color: rgba(15, 23, 42, 0.85);
        backdrop-filter: blur(10px);
        padding: 20px;
        display: flex;
        flex-direction: column;
        border-left: 1px solid rgba(100, 116, 139, 0.3);
        overflow-y: auto;
        z-index: 10;
        height: 100vh;
      }

      .logo {
        display: flex;
        align-items: center;
        margin-bottom: 25px;
      }

      .logo-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 12px;
      }

      .logo h1 {
        font-size: 22px;
        font-weight: 700;
        background: linear-gradient(90deg, #3b82f6, #8b5cf6);
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
      }

      .data-card {
        background-color: rgba(30, 41, 59, 0.7);
        border-radius: 12px;
        padding: 18px;
        margin-bottom: 20px;
        border: 1px solid rgba(100, 116, 139, 0.2);
      }

      .data-card h2 {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 15px;
        color: #94a3b8;
        display: flex;
        align-items: center;
      }

      .data-card h2::before {
        content: "";
        display: inline-block;
        width: 8px;
        height: 8px;
        background-color: #3b82f6;
        border-radius: 50%;
        margin-right: 8px;
      }

      .data-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 12px;
        font-size: 14px;
      }

      .data-label {
        color: #94a3b8;
      }

      .data-value {
        font-weight: 600;
        color: #e2e8f0;
      }

      .prediction-form {
        background-color: rgba(30, 41, 59, 0.7);
        border-radius: 12px;
        padding: 18px;
        margin-bottom: 20px;
        border: 1px solid rgba(100, 116, 139, 0.2);
      }

      .prediction-form h2 {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 15px;
        color: #94a3b8;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 6px;
        font-size: 14px;
        color: #94a3b8;
      }

      .form-group input {
        width: 100%;
        padding: 10px 12px;
        background-color: rgba(15, 23, 42, 0.7);
        border: 1px solid rgba(100, 116, 139, 0.3);
        border-radius: 6px;
        color: #e2e8f0;
        font-size: 14px;
      }

      .form-group input:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
      }

      .btn {
        background: linear-gradient(90deg, #3b82f6, #8b5cf6);
        color: white;
        border: none;
        border-radius: 6px;
        padding: 10px 16px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        width: 100%;
        transition: all 0.3s ease;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
      }

      .prediction-result {
        margin-top: 15px;
        padding: 12px;
        background-color: rgba(15, 23, 42, 0.7);
        border-radius: 6px;
        font-size: 14px;
        display: none;
      }

      .prediction-result.active {
        display: block;
      }

      .prediction-result h3 {
        font-size: 14px;
        margin-bottom: 8px;
        color: #94a3b8;
      }

      .prediction-result p {
        margin-bottom: 5px;
      }

      .status-indicator {
        display: inline-block;
        width: 10px;
        height: 10px;
        background-color: #10b981;
        border-radius: 50%;
        margin-right: 8px;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
        }
        70% {
          box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
        }
      }

      .loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        z-index: 100;
      }

      .loading-spinner {
        border: 3px solid rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        border-top: 3px solid #3b82f6;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 15px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .loading p {
        color: #94a3b8;
      }

      .block-title {
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 15px;
        color: #e2e8f0;
        text-align: center;
        padding-bottom: 10px;
        border-bottom: 1px solid rgba(100, 116, 139, 0.3);
      }

      @media (max-width: 768px) {
        .container {
          flex-direction: column;
        }

        .globe-container {
          flex: 0 0 60%;
          height: 60vh;
        }

        .sidebar {
          flex: 0 0 40%;
          height: 40vh;
          border-left: none;
          border-top: 1px solid rgba(100, 116, 139, 0.3);
        }
      }

      @media (max-width: 480px) {
        .globe-container {
          flex: 0 0 50%;
          height: 50vh;
        }

        .sidebar {
          flex: 0 0 50%;
          height: 50vh;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="globe-container">
        <div id="globe"></div>
        <div class="loading" id="loading">
          <div class="loading-spinner"></div>
          <p>Loading Earth and ISS data...</p>
        </div>
      </div>

      <div class="sidebar">
        <div class="logo">
          <div class="logo-icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"
              ></path>
            </svg>
          </div>
          <h1>ISS Tracker</h1>
        </div>

        <!-- BLOCK 1: GLOBE VIEW -->
        <div class="data-card">
          <div class="block-title">Globe View</div>
          <div class="data-item">
            <span class="data-label">Status:</span>
            <span class="data-value"
              ><span class="status-indicator"></span>Orbiting</span
            >
          </div>
          <div class="data-item">
            <span class="data-label">Latitude:</span>
            <span class="data-value" id="latitude">--</span>
          </div>
          <div class="data-item">
            <span class="data-label">Longitude:</span>
            <span class="data-value" id="longitude">--</span>
          </div>
          <div class="data-item">
            <span class="data-label">Velocity:</span>
            <span class="data-value" id="velocity">--</span>
          </div>
          <div class="data-item">
            <span class="data-label">Altitude:</span>
            <span class="data-value" id="altitude">--</span>
          </div>
          <div class="data-item">
            <span class="data-label">Time:</span>
            <span class="data-value" id="timestamp">--</span>
          </div>
          <div class="data-item">
            <span class="data-label">Date:</span>
            <span class="data-value" id="date">--</span>
          </div>
        </div>

        <!-- BLOCK 2: PREDICTION -->
        <div class="prediction-form">
          <div class="block-title">Predict ISS Position</div>
          <div class="form-group">
            <label for="prediction-date">Select Date & Time:</label>
            <input type="datetime-local" id="prediction-date" />
          </div>
          <button class="btn" id="predict-btn">Calculate Position</button>
          <div class="prediction-result" id="prediction-result">
            <h3>Predicted Position</h3>
            <p><strong>Latitude:</strong> <span id="pred-lat">--</span></p>
            <p><strong>Longitude:</strong> <span id="pred-lon">--</span></p>
            <p><strong>Altitude:</strong> <span id="pred-alt">--</span></p>
            <p><strong>Velocity:</strong> <span id="pred-vel">--</span></p>
            <p>
              <strong>Time to Reach:</strong> <span id="pred-time">--</span>
            </p>
          </div>
        </div>

        <div class="data-card">
          <h2>About ISS</h2>
          <p style="font-size: 14px; line-height: 1.5; color: #cbd5e1">
            The International Space Station (ISS) is a modular space station in
            low Earth orbit. It serves as a microgravity research laboratory
            where crew members conduct experiments in biology, physics,
            astronomy, and other fields.
          </p>
        </div>
      </div>
    </div>

    <script>
      // Global variables
      let scene, camera, renderer, globe, iss, controls;
      let issPosition = { lat: 0, lon: 0, alt: 408, vel: 27600 };
      let issPath = [];
      let animationId;

      // Initialize the 3D scene
      function init() {
        // Create scene
        scene = new THREE.Scene();

        // Create camera
        camera = new THREE.PerspectiveCamera(
          45,
          window.innerWidth / window.innerHeight,
          0.1,
          1000
        );
        camera.position.z = 3.5;

        // Create renderer
        renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.getElementById("globe").appendChild(renderer.domElement);

        // Add controls
        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 2.5;
        controls.maxDistance = 12;

        // Add ambient light
        const ambientLight = new THREE.AmbientLight(0x333333);
        scene.add(ambientLight);

        // Add directional light (sun)
        const sunLight = new THREE.DirectionalLight(0xffffff, 1);
        sunLight.position.set(5, 3, 5);
        scene.add(sunLight);

        // Create Earth
        createEarth();

        // Create ISS
        createISS();

        // Add stars
        createStars();

        // Handle window resize
        window.addEventListener("resize", onWindowResize);

        // Start animation
        animate();

        // Fetch initial ISS data
        fetchISSData();

        // Set up periodic data fetching
        setInterval(fetchISSData, 5000);

        // Hide loading screen
        setTimeout(() => {
          document.getElementById("loading").style.display = "none";
        }, 2000);
      }

      // Create Earth
      function createEarth() {
        const geometry = new THREE.SphereGeometry(1, 64, 64);

        // Load Earth texture
        const textureLoader = new THREE.TextureLoader();
        const earthTexture = textureLoader.load(
          "https://threejs.org/examples/textures/planets/earth_atmos_2048.jpg"
        );
        const bumpTexture = textureLoader.load(
          "https://threejs.org/examples/textures/planets/earth_normal_2048.jpg"
        );
        const specularTexture = textureLoader.load(
          "https://threejs.org/examples/textures/planets/earth_specular_2048.jpg"
        );

        const material = new THREE.MeshPhongMaterial({
          map: earthTexture,
          bumpMap: bumpTexture,
          bumpScale: 0.05,
          specularMap: specularTexture,
          specular: new THREE.Color(0x333333),
        });

        globe = new THREE.Mesh(geometry, material);
        scene.add(globe);

        // Add clouds
        const cloudGeometry = new THREE.SphereGeometry(1.01, 64, 64);
        const cloudTexture = textureLoader.load(
          "https://threejs.org/examples/textures/planets/earth_clouds_1024.png"
        );
        const cloudMaterial = new THREE.MeshPhongMaterial({
          map: cloudTexture,
          transparent: true,
          opacity: 0.3,
        });

        const clouds = new THREE.Mesh(cloudGeometry, cloudMaterial);
        globe.add(clouds);
      }

      // Create ISS
      function createISS() {
        const issGroup = new THREE.Group();

        // ISS body
        const bodyGeometry = new THREE.BoxGeometry(0.05, 0.02, 0.02);
        const bodyMaterial = new THREE.MeshPhongMaterial({ color: 0xcccccc });
        const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
        issGroup.add(body);

        // Solar panels
        const panelGeometry = new THREE.BoxGeometry(0.15, 0.01, 0.04);
        const panelMaterial = new THREE.MeshPhongMaterial({ color: 0x1a5fb4 });

        const leftPanel = new THREE.Mesh(panelGeometry, panelMaterial);
        leftPanel.position.x = -0.1;
        issGroup.add(leftPanel);

        const rightPanel = new THREE.Mesh(panelGeometry, panelMaterial);
        rightPanel.position.x = 0.1;
        issGroup.add(rightPanel);

        // Add a point light to the ISS
        const issLight = new THREE.PointLight(0xffffff, 0.5, 0.2);
        issGroup.add(issLight);

        iss = issGroup;
        scene.add(iss);
      }

      // Create starfield
      function createStars() {
        const starsGeometry = new THREE.BufferGeometry();
        const starsMaterial = new THREE.PointsMaterial({
          color: 0xffffff,
          size: 0.02,
          transparent: true,
        });

        const starsVertices = [];
        for (let i = 0; i < 10000; i++) {
          const x = (Math.random() - 0.5) * 2000;
          const y = (Math.random() - 0.5) * 2000;
          const z = (Math.random() - 0.5) * 2000;
          starsVertices.push(x, y, z);
        }

        starsGeometry.setAttribute(
          "position",
          new THREE.Float32BufferAttribute(starsVertices, 3)
        );
        const starField = new THREE.Points(starsGeometry, starsMaterial);
        scene.add(starField);
      }

      // Convert lat/lon to 3D position
      function latLonToVector3(lat, lon, radius) {
        const phi = (90 - lat) * (Math.PI / 180);
        const theta = (lon + 180) * (Math.PI / 180);

        const x = -(radius * Math.sin(phi) * Math.cos(theta));
        const z = radius * Math.sin(phi) * Math.sin(theta);
        const y = radius * Math.cos(phi);

        return new THREE.Vector3(x, y, z);
      }

      // Update ISS position
      function updateISSPosition() {
        if (!iss) return;

        // Increased distance from Earth (1.5 instead of 1.2)
        const position = latLonToVector3(issPosition.lat, issPosition.lon, 1.5);
        iss.position.copy(position);

        // Make ISS face the direction of travel
        const nextPosition = latLonToVector3(
          issPosition.lat + 0.1,
          issPosition.lon + 0.1,
          1.5
        );
        iss.lookAt(nextPosition);

        // Update UI with real values
        document.getElementById("latitude").textContent =
          issPosition.lat.toFixed(4) + "째";
        document.getElementById("longitude").textContent =
          issPosition.lon.toFixed(4) + "째";
        document.getElementById("velocity").textContent =
          issPosition.vel.toFixed(0) + " km/h";
        document.getElementById("altitude").textContent =
          issPosition.alt.toFixed(1) + " km";

        const now = new Date();
        document.getElementById("timestamp").textContent =
          now.toLocaleTimeString();
        document.getElementById("date").textContent = now.toLocaleDateString();

        // Always add to path
        issPath.push(position.clone());
        updatePath();
      }

      // Update ISS path visualization
      function updatePath() {
        if (issPath.length < 2) return;

        // Remove old path
        if (scene.getObjectByName("issPath")) {
          scene.remove(scene.getObjectByName("issPath"));
        }

        // Create new path
        const geometry = new THREE.BufferGeometry().setFromPoints(issPath);
        const material = new THREE.LineBasicMaterial({
          color: 0x8b5cf6,
          transparent: true,
          opacity: 0.7,
        });

        const pathLine = new THREE.Line(geometry, material);
        pathLine.name = "issPath";
        scene.add(pathLine);

        // Limit path length
        if (issPath.length > 100) {
          issPath.shift();
        }
      }

      // Fetch ISS data from API
      function fetchISSData() {
        fetch("https://api.wheretheiss.at/v1/satellites/25544")
          .then((response) => response.json())
          .then((data) => {
            issPosition.lat = data.latitude;
            issPosition.lon = data.longitude;
            issPosition.alt = data.altitude;
            issPosition.vel = data.velocity;
            updateISSPosition();
          })
          .catch((error) => {
            console.error("Error fetching ISS data:", error);
            // If API fails, use sample data for demonstration
            issPosition.lat = issPosition.lat + (Math.random() - 0.5) * 0.5;
            issPosition.lon = issPosition.lon + (Math.random() - 0.5) * 0.5;
            issPosition.alt = 408 + (Math.random() - 0.5) * 2;
            issPosition.vel = 27600 + (Math.random() - 0.5) * 100;
            updateISSPosition();
          });
      }

      // Animation loop
      function animate() {
        animationId = requestAnimationFrame(animate);

        // Rotate Earth
        if (globe) {
          globe.rotation.y += 0.0005;
        }

        // Update controls
        controls.update();

        // Render scene
        renderer.render(scene, camera);
      }

      // Handle window resize
      function onWindowResize() {
        const container = document.getElementById("globe");
        const width = container.clientWidth;
        const height = container.clientHeight;

        camera.aspect = width / height;
        camera.updateProjectionMatrix();
        renderer.setSize(width, height);
      }

      // Setup prediction form
      document
        .getElementById("predict-btn")
        .addEventListener("click", function () {
          const dateInput = document.getElementById("prediction-date").value;
          if (!dateInput) {
            alert("Please select a date and time");
            return;
          }

          const selectedDate = new Date(dateInput);
          const now = new Date();

          if (selectedDate <= now) {
            alert("Please select a future date and time");
            return;
          }

          // Calculate time difference in seconds
          const timeDiff = (selectedDate - now) / 1000;

          // Calculate orbital period (approximate)
          const orbitalPeriod = 5580; // seconds (92.9 minutes)

          // Calculate orbits completed
          const orbitsCompleted = timeDiff / orbitalPeriod;

          // Calculate new position (simplified calculation)
          const angularVelocity = 360 / orbitalPeriod; // degrees per second
          const angleTraveled = angularVelocity * timeDiff;

          // Convert to radians
          const angleRad = angleTraveled * (Math.PI / 180);

          // Calculate new position (simplified)
          const newLat = issPosition.lat + Math.sin(angleRad) * 10;
          const newLon = issPosition.lon + angleTraveled;

          // Normalize longitude
          let normalizedLon = newLon % 360;
          if (normalizedLon > 180) normalizedLon -= 360;
          if (normalizedLon < -180) normalizedLon += 360;

          // Calculate predicted altitude and velocity (simplified)
          const predAlt = issPosition.alt + Math.sin(angleRad) * 5;
          const predVel = issPosition.vel + Math.sin(angleRad) * 50;

          // Display prediction
          document.getElementById("pred-lat").textContent =
            newLat.toFixed(4) + "째";
          document.getElementById("pred-lon").textContent =
            normalizedLon.toFixed(4) + "째";
          document.getElementById("pred-alt").textContent =
            predAlt.toFixed(1) + " km";
          document.getElementById("pred-vel").textContent =
            predVel.toFixed(0) + " km/h";

          // Format time difference
          const days = Math.floor(timeDiff / (3600 * 24));
          const hours = Math.floor((timeDiff % (3600 * 24)) / 3600);
          const minutes = Math.floor((timeDiff % 3600) / 60);

          let timeStr = "";
          if (days > 0) timeStr += `${days}d `;
          if (hours > 0) timeStr += `${hours}h `;
          if (minutes > 0) timeStr += `${minutes}m `;

          document.getElementById("pred-time").textContent = timeStr;
          document.getElementById("prediction-result").classList.add("active");
        });

      // Set default prediction date to 1 hour from now
      const defaultDate = new Date();
      defaultDate.setHours(defaultDate.getHours() + 1);
      document.getElementById("prediction-date").value = defaultDate
        .toISOString()
        .slice(0, 16);

      // Initialize the application
      init();
    </script>
  </body>
</html>
